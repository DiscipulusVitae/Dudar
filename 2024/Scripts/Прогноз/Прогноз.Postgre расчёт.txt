Postgre. Существующий расчёт прогноза продаж.

pp = past period 

Диапазон дат от вчера до _date >= current_date::date - interval '30 day'
pp_sum = сумма продаж
pp_wd_cnt = кол-во дней, которые считаются как рабочие
pp_se_cnt = кол-во дней, которые считаются как суббота или посл.день месяца
pp_sd_cnt = кол-во дней, которые считаются как воскресения
Суммы продаж за эти дни:
pp_wd_sum 
pp_se_sum
pp_sd_sum
Средние продажи за день для каждого из трёх типов дня:
pp_wd_avg = pp_wd_sum / pp_wd_cnt
pp_se_avg = pp_se_sum / pp_se_cnt
pp_sd_avg = pp_sd_sum / pp_sd_cnt


fp = future/forecast period

Далее сам прогноз. Прогнозируемый период от сегодня до конца текущего месяца.
pp_wd_avg = fp_wd_avg
pp_se_avg = fp_se_avg
pp_sd_avg = fp_sd_avg
Подсчёт дней прогнозируемого периода.
fp_wd_cnt = кол-во дней, которые считаются как рабочие
fp_se_cnt = кол-во дней, которые считаются как суббота или посл.день месяца
fp_sd_cnt = кол-во дней, которые считаются как воскресения

Соответственно можем теперь посчитать тотал сумму прогноза по каждому типу дня
fp_wd_sum = fp_wd_cnt*fp_wd_avg
fp_se_sum = fp_se_cnt*fp_se_avg
fp_sd_sum = fp_sd_cnt*fp_sd_avg

И наконец можем сложить эти три слагаемых и посчитать общий прогноз на остаток месяца fp_sum.

Этот вариант расчёта уже реализован. Мне инетерсен новый вариант - как арифметически вычлениеть кэффициент, на который нужно умножить pp_sum, чтоб получть fp_sum. Нам дан лишь _calendar с полями _date, _day_type_forecast. И таблица продаж "Док_ЗаказРеализацияВозврат" с полями "Дата" и "Сумма", т.е. мы знаем сумму продаж выборки за прошедший период.